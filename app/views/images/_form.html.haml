#uploader
  #upload_box
    #upload_box_message_container
      %p#upload_box_message Drag & Drop Files Here
  %ul.unstyled#file_list
  %button.btn.large.primary#start_upload{:data => {:'loading-text' => 'Uploading', :'complete-text' => 'Uploaded!'}} Upload

:coffeescript
  colorbox_init = ->
    $(".thumbnail").colorbox
      maxWidth: "95%"
      maxHeight: "95%"
      rel: 'gallery'
  $ ->
    $('#start_upload').button()
    uploader = new plupload.Uploader(
      runtimes: "html5,flash"
      browse_button: "pickfiles"
      max_file_size: "10mb"
      url: "#{url_for [@category, @album, Image.new]}.js"
      file_data_name: 'image[image]'
      flash_swf_url: "#{asset_path("plupload.flash.swf")}"
      drop_element: 'upload_box'
      multipart: true
      multipart_params:
        "#{request_forgery_protection_token}": "#{form_authenticity_token}"
        "#{request.session_options[:key]}": "#{request.session_options[:id]}"
      )
    uploader.bind "FilesAdded", (up, files) ->
      $.each files, (i, file) ->
        $("#file_list").append "<li id=\"" + file.id + "\">" + "File: " + file.name + " (" + plupload.formatSize(file.size) + ") <b></b>" + "</li>"
    uploader.bind "UploadProgress", (up, file) ->
      $("#" + file.id + " b").html file.percent + "%"
    $("#start_upload").click (e) ->
      uploader.start()
      $(this).button('loading')
      e.preventDefault()
    uploader.bind 'FileUploaded', (up, file, response) ->
      eval(response.response)
      colorbox_init()
    uploader.bind 'UploadComplete', (up, files) ->
      $('#start_upload').button('complete')
    uploader.init()
    colorbox_init()